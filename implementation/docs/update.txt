Replaced every asyncpg.types.Json usage in the stores with our own encoder/decoder (see memory.py, context.py, guardrails.py) and added json_encoding.py to handle JSONB conversions centrally. After a container restart the stream endpoint no longer crashes on JSON encoding, though the task still fails with the pre-existing “pool is not initialized” error. No tests were executed.

Next up: 1) trace the orchestrator pool lifecycle so that pool is not initialized clears, 2) re-test /api/v1/submit_task(/stream) once the pools are fixed, and 3) run pytest before packaging the commit that now also includes your Docker/alembic tweaks plus the new JSON utility.