%% NeuraForge System Architecture Diagram
%% Render with: mmdc -i system-architecture.mmd -o system-architecture.png

%%{init: {"theme": "forest", "flowchart": {"curve": "basis"}} }%%
graph TD
    subgraph Frontend
        A["Next.js 14 UI\nSocket.io Client"]
    end

    subgraph Backend
        B["FastAPI API Layer\nAuth & Validation"]
        C["Task Queue Manager\n(Async + Redis)"]
        D["LangGraph Orchestrator\nCapability Routing"]
        K["Conflict Resolver\nMeta-Agent"]
    end

    subgraph Agents
        E1["Research Agent"]
        E2["Finance Agent"]
        E3["Creative Agent"]
        E4["Enterprise Agent"]
    end

    subgraph Memory[Hybrid Memory Layer]
        F1["Redis\nWorking Memory"]
        F2["PostgreSQL\nEpisodic Memory"]
        F3["Qdrant\nSemantic Memory"]
    end

    subgraph LLM[LLM & Embeddings]
        G["LangChain Wrapper"]
        H["Ollama\nLLaMA 3"]
        I["Sentence Transformers\nEmbeddings"]
    end

    subgraph Observability
        J1["Structlog JSON Logs"]
        J2["Prometheus Metrics"]
        J3["Grafana Dashboards"]
    end

    A -->|Tasks / Streams| B
    B -->|Submit Task| C
    C -->|Dispatch Jobs| D
    D -->|Select Agents| E1
    D --> E2
    D --> E3
    D --> E4
    E1 -->|Insights| D
    E2 -->|Forecasts| D
    E3 -->|Creative Output| D
    E4 -->|Strategy| D
    D -->|LLM Calls| G
    G --> H
    G --> I
    D -->|Store / Retrieve| F1
    D --> F2
    D --> F3
    K --> D
    D --> K
    B -->|Status / Results| A
    B -->|Metrics| J2
    J2 --> J3
    B --> J1
