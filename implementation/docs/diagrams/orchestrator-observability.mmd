%% Orchestrator observability data flow
%% Render with: mmdc -i docs/diagrams/orchestrator-observability.mmd -o docs/diagrams/orchestrator-observability.png

flowchart TD
    subgraph Orchestrator
        Agents[Agent Execution]
        Negotiation[Negotiation Engine]
        Planner[Planner & Scheduler]
        Guardrails[Guardrail Manager]
    end

    Agents -->|latency, outcomes| Metrics((Prometheus Metrics))
    Negotiation -->|rounds, consensus| Metrics
    Planner -->|sla, schedule| Metrics
    Guardrails -->|decisions, escalations| Metrics

    Metrics --> Rules[Prometheus Recording Rules]
    Rules --> Alerts[Alertmanager]
    Metrics --> Grafana

    Grafana -->|Dashboards| Devs[Developers]
    Alerts -->|Pager / Slack| Devs

    subgraph Simulation Harness
        SimTasks[Simulation Scenarios]
        Harness[SimulationHarness]
    end

    SimTasks --> Harness
    Harness -->|replays tasks| Orchestrator
    Harness -->|evaluation metrics| Metrics
    Harness --> Notebook[Phase 5 Notebook]

    Notebook -->|reports| Devs
