%% NeuraForge Task Lifecycle Sequence Diagram
%% Render with: mmdc -i task-lifecycle.mmd -o task-lifecycle.png

%%{init: {"theme": "neutral"}}%%
sequenceDiagram
    participant User as User
    participant FE as Frontend (Next.js)
    participant API as FastAPI Backend
    participant Queue as Task Queue
    participant Orchestrator as LangGraph Orchestrator
    participant Agent as Specialized Agents
    participant Memory as Hybrid Memory
    participant LLM as LLM Layer (Ollama)

    User->>FE: Enter task prompt
    FE->>API: POST /api/v1/submit_task
    API->>Queue: Enqueue task job
    Queue-->>API: Ack task_id
    API->>FE: Return queued status
    Queue->>Orchestrator: Dispatch task
    Orchestrator->>Memory: Load context
    Orchestrator->>Agent: Delegate sub-task
    Agent->>LLM: Request completion (if needed)
    LLM-->>Agent: Generated content
    Agent->>Memory: Store insights (Redis/Postgres/Qdrant)
    Agent-->>Orchestrator: Result + confidence
    Orchestrator->>Orchestrator: Conflict resolution / negotiation
    Orchestrator->>Memory: Persist task outcome
    Orchestrator->>API: Deliver final result
    API->>FE: Stream updates via Socket.io
    FE-->>User: Display responses and history
